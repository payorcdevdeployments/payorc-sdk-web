{"version":3,"file":"payorc.umd.cjs","sources":["../src/PaymentSDK.ts","../src/index.ts"],"sourcesContent":["/**\n * PayOrc SDK - A lightweight client-side SDK for integrating payment processing\n */\n\ninterface PaymentConfig {\n  apiKey: string;\n  merchantSecret: string;\n  environment?: 'test' | 'production';\n  onSuccess?: (response: any) => void;\n  onFailure?: (error: any) => void;\n  onCancel?: () => void;\n}\n\ninterface OrderDetails {\n  m_order_id: string;\n  amount: string;\n  convenience_fee: string;\n  currency: string;\n  description?: string;\n  quantity: string;\n}\n\ninterface CustomerDetails {\n  name: string;\n  m_customer_id: string;\n  email: string;\n  mobile?: string;\n  code?: string;\n}\n\ninterface BillingDetails {\n  address_line1: string;\n  address_line2?: string;\n  city: string;\n  province: string;\n  pin: string;\n  country: string;\n}\n\ninterface ShippingDetails {\n  shipping_name: string;\n  shipping_email?: string;\n  shipping_code?: string;\n  shipping_mobile?: string;\n  address_line1: string;\n  address_line2?: string;\n  city: string;\n  province: string;\n  pin: string;\n  country: string;\n  location_pin?: string;\n  shipping_currency: string;\n  shipping_amount: string;\n}\n\ninterface UrlDetails {\n  success?: string;\n  cancel?: string;\n  failure?: string;\n}\n\ninterface KeyValuePair {\n  [key: string]: string;\n}\n\ninterface PaymentData {\n  class: 'ECOM';\n  action: 'SALE';\n  capture_method: 'AUTOMATIC';\n  payment_token?: string;\n  order_details: OrderDetails;\n  customer_details: CustomerDetails;\n  billing_details: BillingDetails;\n  shipping_details: ShippingDetails;\n  urls?: UrlDetails;\n  parameters?: KeyValuePair[];\n  custom_data?: KeyValuePair[];\n}\n\ninterface PaymentRequest {\n  data: PaymentData;\n}\n\ninterface PaymentResponse {\n  status: string;\n  status_code: string;\n  message: string;\n  p_order_id: number;\n  m_order_id: string;\n  p_request_id: number;\n  order_creation_date: string;\n  amount: string;\n  payment_link: string;\n  iframe_link: string;\n}\n\ninterface ValidationResponse {\n  message: string;\n  status: string;\n  code?: string;\n}\n\ntype PaymentEventType = 'success' | 'failure' | 'cancel' | 'processing';\n\ninterface PaymentEventListener {\n  type: PaymentEventType;\n  callback: (data?: any) => void;\n}\n\nclass PaymentSDK {\n  private static instance: PaymentSDK | null = null;\n  private apiKey: string = '';\n  private merchantSecret: string = '';\n  private environment: 'test' | 'production' = 'test';\n  private baseUrl: string = 'https://nodeserver.payorc.com/api/v1';\n  private modal: HTMLDivElement | null = null;\n  private iframe: HTMLIFrameElement | null = null;\n  private eventListeners: PaymentEventListener[] = [];\n  private config: PaymentConfig | null = null;\n  private isValidated: boolean = false;\n\n  private constructor() {\n    window.addEventListener('message', this.handlePostMessage.bind(this));\n  }\n\n  public static getInstance(): PaymentSDK {\n    if (!PaymentSDK.instance) {\n      PaymentSDK.instance = new PaymentSDK();\n    }\n    return PaymentSDK.instance;\n  }\n\n  public async init(config: PaymentConfig): Promise<PaymentSDK> {\n    this.apiKey = config.apiKey;\n    this.merchantSecret = config.merchantSecret;\n    this.environment = config.environment || 'test';\n    this.config = config;\n    \n    if (config.onSuccess) this.on('success', config.onSuccess);\n    if (config.onFailure) this.on('failure', config.onFailure);\n    if (config.onCancel) this.on('cancel', config.onCancel);\n\n    try {\n      const response = await fetch(`${this.baseUrl}/check/keys-secret`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          merchant_key: this.apiKey,\n          merchant_secret: this.merchantSecret,\n          env: this.environment\n        })\n      });\n\n      const validationResponse: ValidationResponse = await response.json();\n      \n      if (validationResponse.status === 'success') {\n        this.isValidated = true;\n        return this;\n      } else {\n        throw new Error(validationResponse.message || 'Invalid merchant key or secret');\n      }\n    } catch (error) {\n      this.isValidated = false;\n      throw error;\n    }\n  }\n\n  private getBrowserInfo(): { platform: string; browser: string; browserVersion: string } {\n    const platform = navigator.platform || 'unknown';\n    const userAgent = navigator.userAgent;\n    let browser = 'unknown';\n    let browserVersion = 'unknown';\n\n    if (userAgent.indexOf('Chrome') !== -1) {\n      browser = 'Chrome';\n      const match = userAgent.match(/Chrome\\/(\\d+\\.\\d+)/);\n      if (match) browserVersion = match[1];\n    } else if (userAgent.indexOf('Firefox') !== -1) {\n      browser = 'Firefox';\n      const match = userAgent.match(/Firefox\\/(\\d+\\.\\d+)/);\n      if (match) browserVersion = match[1];\n    } else if (userAgent.indexOf('Safari') !== -1) {\n      browser = 'Safari';\n      const match = userAgent.match(/Version\\/(\\d+\\.\\d+)/);\n      if (match) browserVersion = match[1];\n    } else if (userAgent.indexOf('Edge') !== -1 || userAgent.indexOf('Edg') !== -1) {\n      browser = 'Edge';\n      const match = userAgent.match(/Edge?\\/(\\d+\\.\\d+)/);\n      if (match) browserVersion = match[1];\n    } else if (userAgent.indexOf('Opera') !== -1 || userAgent.indexOf('OPR') !== -1) {\n      browser = 'Opera';\n      const match = userAgent.match(/OPR\\/(\\d+\\.\\d+)/);\n      if (match) browserVersion = match[1];\n    }\n\n    return { platform, browser, browserVersion };\n  }\n\n  public async createPayment(paymentData: PaymentData): Promise<PaymentResponse | null> {\n    if (!this.isValidated) {\n      throw new Error('SDK validation failed. Please check your merchant key and secret.');\n    }\n\n    if (!this.apiKey || !this.merchantSecret) {\n      throw new Error('SDK not initialized. Call init() first.');\n    }\n\n    try {\n      const paymentRequest: PaymentRequest = { data: paymentData };\n      const { platform, browser, browserVersion } = this.getBrowserInfo();\n\n      const response = await fetch(`${this.baseUrl}/sdk/orders/create`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'merchant-key': this.apiKey,\n          'merchant-secret': this.merchantSecret,\n          'platform': platform,\n          'browser': browser,\n          'browser-version': browserVersion\n        },\n        body: JSON.stringify(paymentRequest)\n      });\n\n      const responseData: PaymentResponse = await response.json();\n\n      if (responseData.status !== 'SUCCESS') {\n        this.triggerEvent('failure', responseData);\n        return null;\n      }\n\n      this.loadModal(responseData.iframe_link);\n      this.triggerEvent('processing', responseData);\n      return responseData;\n    } catch (error) {\n      console.error('Error creating payment:', error);\n      this.triggerEvent('failure', { error });\n      return null;\n    }\n  }\n\n  public on(eventType: PaymentEventType, callback: (data?: any) => void): PaymentSDK {\n    this.eventListeners.push({ type: eventType, callback });\n    return this;\n  }\n\n  public off(eventType: PaymentEventType, callback: (data?: any) => void): PaymentSDK {\n    this.eventListeners = this.eventListeners.filter(\n      listener => !(listener.type === eventType && listener.callback === callback)\n    );\n    return this;\n  }\n\n  public close(): void {\n    if (this.modal) {\n      document.body.removeChild(this.modal);\n      this.modal = null;\n    }\n  }\n\n  private handlePostMessage(event: MessageEvent): void {\n    try {\n      const data = typeof event.data === 'string' ? JSON.parse(event.data) : event.data;\n      \n      if (data.status === \"SUCCESS\") {\n        this.triggerEvent('success', data);\n        this.close();\n      } else if (data.status === \"CANCELLED\") {\n        this.triggerEvent('cancel', data);\n        this.close();\n      } else if (data.status === \"FAILED\") {\n        this.triggerEvent('failure', data);\n        this.close();\n      }\n    } catch (error) {\n      console.error('Error processing message:', error);\n    }\n  }\n\n  private triggerEvent(eventType: PaymentEventType, data?: any): void {\n    this.eventListeners\n      .filter(listener => listener.type === eventType)\n      .forEach(listener => {\n        try {\n          listener.callback(data);\n        } catch (error) {\n          console.error(`Error in ${eventType} event listener:`, error);\n        }\n      });\n  }\n\n  private loadModal(iframeUrl: string): void {\n    this.modal = document.createElement('div');\n    Object.assign(this.modal.style, {\n      position: 'fixed',\n      top: '0',\n      left: '0',\n      width: '100%',\n      height: '100%',\n      backgroundColor: 'rgba(0, 0, 0, 0.5)',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      zIndex: '9999'\n    });\n\n    const modalContent = document.createElement('div');\n    Object.assign(modalContent.style, {\n      width: '90%',\n      maxWidth: '600px',\n      height: '90vh',\n      maxHeight: '800px',\n      backgroundColor: '#ffffff',\n      borderRadius: '8px',\n      boxShadow: '0 4px 12px rgba(0, 0, 0, 0.15)',\n      position: 'relative',\n      overflow: 'hidden'\n    });\n\n    // Create loader container\n    const loaderContainer = document.createElement('div');\n    Object.assign(loaderContainer.style, {\n      position: 'absolute',\n      top: '0',\n      left: '0',\n      width: '100%',\n      height: '100%',\n      backgroundColor: '#ffffff',\n      display: 'flex',\n      justifyContent: 'center',\n      alignItems: 'center',\n      zIndex: '1'\n    });\n\n    // Add spinner image\n    const spinner = document.createElement('img');\n    spinner.src = 'https://checkout.payorc.com/checkout/public/images/spinner-loader.gif';\n    spinner.alt = 'Loading...';\n    Object.assign(spinner.style, {\n      width: '50px',\n      height: '50px'\n    });\n\n    loaderContainer.appendChild(spinner);\n    modalContent.appendChild(loaderContainer);\n\n    this.iframe = document.createElement('iframe');\n    Object.assign(this.iframe.style, {\n      width: '100%',\n      height: '100%',\n      border: 'none',\n      opacity: '0',\n      transition: 'opacity 0.3s ease'\n    });\n    this.iframe.src = iframeUrl;\n    this.iframe.setAttribute('allowpaymentrequest', 'true');\n    this.iframe.setAttribute('allow', 'payment');\n\n    modalContent.appendChild(this.iframe);\n    this.modal.appendChild(modalContent);\n\n    // Hide loader and show iframe after 3 seconds\n    setTimeout(() => {\n      if (loaderContainer.parentNode) {\n        loaderContainer.parentNode.removeChild(loaderContainer);\n      }\n      if (this.iframe) {\n        this.iframe.style.opacity = '1';\n      }\n    }, 3000);\n\n    // Prevent closing when clicking outside\n    this.modal.addEventListener('click', (e) => {\n      if (e.target === this.modal) {\n        e.preventDefault();\n        e.stopPropagation();\n      }\n    });\n\n    // Add responsive styles\n    const styleSheet = document.createElement('style');\n    styleSheet.textContent = `\n      @media (max-width: 768px) {\n        .payorc-modal-content {\n          width: 95%;\n          height: 95vh;\n          margin: 10px;\n        }\n      }\n    `;\n    document.head.appendChild(styleSheet);\n\n    modalContent.classList.add('payorc-modal-content');\n    document.body.appendChild(this.modal);\n  }\n}\n\nexport type {\n  PaymentConfig,\n  PaymentData,\n  OrderDetails,\n  CustomerDetails,\n  BillingDetails,\n  ShippingDetails,\n  UrlDetails,\n  PaymentResponse,\n  PaymentEventType\n};\n\nexport default PaymentSDK;","/**\n * PayOrc SDK - Main entry point\n */\n\nimport PaymentSDK from './PaymentSDK';\nimport type {\n  PaymentConfig,\n  PaymentData,\n  OrderDetails,\n  CustomerDetails,\n  BillingDetails,\n  ShippingDetails,\n  UrlDetails,\n  PaymentResponse,\n  PaymentEventType\n} from './PaymentSDK';\n\n// Export the singleton instance\nconst payorc = PaymentSDK.getInstance();\n\n// Export types for TypeScript users\nexport type {\n  PaymentConfig,\n  PaymentData,\n  OrderDetails,\n  CustomerDetails,\n  BillingDetails,\n  ShippingDetails,\n  UrlDetails,\n  PaymentResponse,\n  PaymentEventType\n};\n\n// Export the SDK instance as default\nexport default payorc;"],"names":["_PaymentSDK","config","validationResponse","error","platform","userAgent","browser","browserVersion","match","paymentData","paymentRequest","responseData","eventType","callback","listener","event","data","iframeUrl","modalContent","loaderContainer","spinner","e","styleSheet","PaymentSDK"],"mappings":"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"}